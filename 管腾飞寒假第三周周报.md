## 实题笔记  
**任意文件漏洞**  
**判断方法**  
- 出现使用?file=123.txt的url来展示内容
- 直接用?file=../../../etc/passwd直接检测


**查看文件源码**
- 使用?file=../../../proc/self/cmdline查看运行的程序
- 不断调整”../“的数量，用相对路径打开它


**分析代码**
```pathon
import os
import uuid
from flask import Flask, request, session, render_template, Markup
from cat import cat

flag = ""
app = Flask(
    _name__,
    static_url_path='/',
    static_folder='static'
)

app.config['SECRET_KEY'] = str(uuid.uuid4()).replace("-", "") + "*abcdefgh"

if os.path.isfile("/flag"):
    flag = cat("/flag")
    os.remove("/flag")

@app.route('/', methods=['GET'])
def index():
    detailtxt = os.listdir('./details/')
    cats_list = []
    for i in detailtxt:
        cats_list.append(i[:i.index('.')])
    
    return render_template("index.html", cats_list=cats_list, cat=cat)

@app.route('/info', methods=["GET", 'POST'])
def info():
    filename = "./details/" + request.args.get('file', "")
    start = request.args.get('start', "0")
    end = request.args.get('end', "0")
    name = request.args.get('file', "")[:request.args.get('file', "").index('.')]
    
    return render_template("detail.html", catname=name, info=cat(filename, start, end))

@app.route('/admin', methods=["GET"])
def admin_can_list_root():
    if session.get('admin') == 1:
        return flag
    else:
        session['admin'] = 0
        return "NoNoNo"

if __name__ == '__main__':
    app.run(host='0.0.0.0', debug=False, port=5637)
```

很容易看出我不会分析这一大串代码
所以根据答案可以知道要分析cat.py

得到
```python
mport os, sys, getopt


def cat(filename, start=0, end=0)->bytes:
 data = b''
 
 try:
	start = int(start)
	end = int(end)
 
 except:
	start=0
	end=0
 
 if filename != "" and os.access(filename, os.R_OK):
 f = open(filename, "rb")

 if start >= 0:
	f.seek(start)
	if end >= start and end != 0:
		data = f.read(end-start)
 
 else:
	data = f.read()
	
 else:
	data = f.read()
 
 f.close()
 
 else:
 data = ("File `%s` not exist or can not be read" % filename).encode()
 
 return data


if __name__ == '__main__':
 opts,args = getopt.getopt(sys.argv[1:],'-h-f:-s:-e:',['help','file=','start=','end='])
 fileName = ""
 start = 0
 end = 0
 
 for opt_name, opt_value in opts:
	if opt_name == '-h' or opt_name == '--help':
		print("[*] Help")
		print("-f --file File name")
		print("-s --start Start position")
		print("-e --end End position")
		print("[*] Example of reading /etc/passwd")
		print("python3 cat.py -f /etc/passwd")
		print("python3 cat.py --file /etc/passwd")
		print("python3 cat.py -f /etc/passwd -s 1")
		print("python3 cat.py -f /etc/passwd -e 5")
		print("python3 cat.py -f /etc/passwd -s 1 -e 5")
		exit()
	
	elif opt_name == '-f' or opt_name == '--file':
		fileName = opt_value
	
	elif opt_name == '-s' or opt_name == '--start':
		start = opt_value
	
	elif opt_name == '-e' or opt_name == '--end':
		end = opt_value
	
	if fileName != "":
		print(cat(fileName, start, end)) 
	
	else:
		print("No file to read")
```

